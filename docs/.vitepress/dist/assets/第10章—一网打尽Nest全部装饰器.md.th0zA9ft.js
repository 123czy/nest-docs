import{_ as s,c as i,o as a,V as p}from"./chunks/framework.BbAbY5cn.js";const t="/assets/第10章-1.JPbUsa_J.png",n="/assets/第10章-2.f8FCAmLG.png",l="/assets/第10章-3.0sLpCkvr.png",e="/assets/第10章-4.898A9eJE.png",h="/assets/第10章-5.f9b6c91f.png",r="/assets/第10章-6.4G9E-y_I.png",k="/assets/第10章-7.9CaD42HK.png",o="/assets/第10章-8.WFDcYhcx.png",E="/assets/第10章-9.WeH6bibV.png",g="/assets/第10章-10.XDEuA0iE.png",c="/assets/第10章-11.-YbFQWg6.png",d="/assets/第10章-12.N1F19BX2.png",m="/assets/第10章-13.4OIA2pGs.png",_="/assets/第10章-14.24szexug.png",y="/assets/第10章-15.NyyN8SKw.png",F="/assets/第10章-16.l8DC7Z8K.png",C="/assets/第10章-17.57Iw-XJ0.png",u="/assets/第10章-18.zidXh4CD.png",B="/assets/第10章-19.S_Cw1oWM.png",b="/assets/第10章-20.saQl3F0E.png",A="/assets/第10章-21.jII0_KSK.png",v="/assets/第10章-22.93_HIVXL.png",D="/assets/第10章-23.3Gc7KWLA.png",x="/assets/第10章-24.kbSkZKNs.png",N="/assets/第10章-25.dWTBNKfD.png",f="/assets/第10章-26.y7E902Cs.png",j="/assets/第10章-27.wK4CGogg.png",P="/assets/第10章-28.NrWZ7A5j.png",R="/assets/第10章-29.XfPQOrci.png",H="/assets/第10章-30.dCR3AKcq.png",q="/assets/第10章-31.Es3N-BC2.png",G="/assets/第10章-32.lKjg9wqC.png",I="/assets/第10章-33.LT_BaRGS.png",V="/assets/第10章-34.ephqqMlz.png",K="/assets/第10章-35.knjc_cBc.png",S="/assets/第10章-36.4fOVZhrM.png",w="/assets/第10章-37.qa2hujb1.png",M="/assets/第10章-38.DEHtykVj.png",O="/assets/第10章-39.HXBG1IC_.png",J="/assets/第10章-40.fgFRxg8A.png",L="/assets/第10章-41.uKyW98eK.png",T="/assets/第10章-42.v7efCgb8.png",W="/assets/第10章-43.VkfDGKCu.png",Q="/assets/第10章-44.4mLK4rzV.png",U="/assets/第10章-45.sarp-jUE.png",X="/assets/第10章-46.RMR436el.png",z="/assets/第10章-47.RBkIBqjx.png",Z="/assets/第10章-48.dBLqV1xA.png",$="/assets/第10章-47.RBkIBqjx.png",Y="/assets/第10章-50.Hov7eCOe.png",ss="/assets/第10章-51.E1JI1V04.png",is="/assets/第10章-52.pZ0US48s.png",as="/assets/第10章-53.7nVqCfj1.png",ps="/assets/第10章-54.ivJDxGqJ.png",ts="/assets/第10章-55.1DW41LVN.png",ns="/assets/第10章-56.rL3H6U7X.png",ls="/assets/第10章-57.TtQ_e9Nu.png",es="/assets/第10章-58.hxgRAsJN.png",hs="/assets/第10章-59.GcCtQ0PN.png",rs="/assets/第10章-60.nepPIK78.png",ks="/assets/第10章-61.l_OHDrzI.png",os="/assets/第10章-62.AR9D04AP.png",bs=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"第10章—一网打尽Nest全部装饰器.md","filePath":"第10章—一网打尽Nest全部装饰器.md"}'),Es={name:"第10章—一网打尽Nest全部装饰器.md"},gs=p(`<p>Nest 的功能都是大多通过装饰器来使用的，这节我们就把所有的装饰器过一遍。</p><p>我们创建个新的 nest 项目：</p><pre><code>nest new all-decorator -p npm
</code></pre><p><img src="`+t+'" alt=""></p><p>Nest 提供了一套模块系统，通过 @Module声明模块：</p><p><img src="'+n+'" alt=""></p><p>通过 @Controller、@Injectable 分别声明其中的 controller 和 provider：</p><p><img src="'+l+'" alt=""></p><p><img src="'+e+'" alt=""></p><p>这个 provider 可以是任何的 class：</p><p><img src="'+h+'" alt=""></p><p>注入的方式可以是构造器注入：</p><p><img src="'+r+'" alt=""></p><p>或者属性注入：</p><p><img src="'+k+'" alt=""></p><p>属性注入要指定注入的 token，可能是 class 也可能是 string。</p><p>你可以通过 useFactory、useValue 等方式声明 provider：</p><p><img src="'+o+'" alt=""></p><p>这时候也需要通过 @Inject 指定注入的 token：</p><p><img src="'+E+'" alt=""></p><p><img src="'+g+'" alt=""></p><p>这些注入的依赖如果没有的话，创建对象时会报错。但如果它是可选的，你可以用 @Optional 声明一下，这样没有对应的 provider 也能正常创建这个对象。</p><p><img src="'+c+'" alt=""></p><p>如果模块被很多地方都引用，为了方便，可以用 @Global 把它声明为全局的，这样它 exports 的 provider 就可以直接注入了：</p><p><img src="'+d+'" alt=""></p><p>filter 是处理抛出的未捕获异常的，通过 @Catch 来指定处理的异常：</p><p><img src="'+m+'" alt=""></p><p>然后通过 @UseFilters 应用到 handler 上：</p><p><img src="'+_+'" alt=""></p><p><img src="'+y+'" alt=""></p><p>除了 filter 之外，interceptor、guard、pipe 也是这样用：</p><p><img src="'+F+'" alt=""></p><p>当然，pipe 更多还是单独在某个参数的位置应用：</p><p><img src="'+C+'" alt=""></p><p>这里的 @Query 是取 url 后的 ?bbb=true，而 @Param 是取路径中的参数，比如 /xxx/111 种的 111</p><p><img src="'+u+'" alt=""></p><p><img src="'+B+'" alt=""></p><p>此外，如果是 @Post 请求，可以通过 @Body 取到 body 部分：</p><p><img src="'+b+'" alt=""></p><p>我们一般用 dto 的 class 来接受请求体里的参数：</p><p><img src="'+A+'" alt=""></p><p>nest 会实例化一个 dto 对象：</p><p>用 postman 发个 post 请求：</p><p><img src="'+v+'" alt=""></p><p>可以看到 nest 接受到了 body 里的参数：</p><p><img src="'+D+'" alt=""></p><p>除了 @Get、@Post 外，还可以用 @Put、@Delete、@Patch、@Options、@Head 装饰器分别接受 put、delete、patch、options、head 请求：</p><p><img src="'+x+'" alt=""></p><p>handler 和 class 可以通过 @SetMetadata 指定 metadata：</p><p><img src="'+N+'" alt=""></p><p>然后在 guard 或者 interceptor 里取出来：</p><p><img src="'+f+'" alt=""></p><p><img src="'+j+'" alt=""></p><p>你可以通过 @Headers 装饰器取某个请求头 或者全部请求头：</p><p><img src="'+P+'" alt=""></p><p><img src="'+R+'" alt=""></p><p>通过 @Ip 拿到请求的 ip：</p><p><img src="'+H+'" alt=""></p><p>通过 @Session 拿到 session 对象：</p><p><img src="'+q+`" alt=""></p><p>但要使用 session 需要安装一个 express 中间件：</p><pre><code>npm install express-session
</code></pre><p>在 main.ts 里引入并启用：</p><p><img src="`+G+'" alt=""></p><p>指定加密的密钥和 cookie 的存活时间。</p><p>然后刷新页面：</p><p><img src="'+I+'" alt=""></p><p>会返回 set-cookie 的响应头，设置了 cookie，包含 sid 也就是 sesssionid。</p><p>之后每次请求都会自动带上这个 cookie：</p><p><img src="'+V+'" alt=""></p><p>这样就可以在 session 对象里存储信息了。</p><p><img src="'+K+'" alt=""></p><p><img src="'+S+`" alt=""></p><p>@HostParam 用于取域名部分的参数：</p><p>我们再创建个 controller：</p><pre><code>nest g controller aaa --no-spec --flat
</code></pre><p><img src="`+w+`" alt=""></p><p>这样指定 controller 的生效路径：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Controller, Get, HostParam } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@nestjs/common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Controller</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ host: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;:host.0.0.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;aaa&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AaaController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bbb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;hello&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>controller 除了可以指定某些 path 生效外，还可以指定 host：</p><p><img src="`+M+'" alt=""></p><p>然后再访问下：</p><p><img src="'+O+`" alt=""></p><p>这时候你会发现只有 host 满足 xx.0.0.1 的时候才会路由到这个 controller。</p><p>host 里的参数就可以通过 @HostParam 取出来：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Controller, Get, HostParam } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@nestjs/common&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Controller</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ host: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;:host.0.0.1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, path: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;aaa&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> })</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AaaController</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bbb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    hello</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">HostParam</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;host&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> host;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><img src="`+J+'" alt=""></p><p>前面取的这些都是 request 里的属性，当然也可以直接注入 request 对象：</p><p><img src="'+L+'" alt=""></p><p>通过 @Req 或者 @Request 装饰器，这俩是同一个东西：</p><p><img src="'+T+'" alt=""></p><p>注入 request 对象后，可以手动取任何参数：</p><p><img src="'+W+'" alt=""></p><p>当然，也可以 @Res 或者 @Response 注入 response 对象，只不过 response 对象有点特殊：</p><p><img src="'+Q+'" alt=""></p><p>当你注入 response 对象之后，服务器会一直没有响应：</p><p><img src="'+U+'" alt=""></p><p>因为这时候 Nest 就不会再把 handler 返回值作为响应内容了。</p><p>你可以自己返回响应：</p><p><img src="'+X+'" alt=""></p><p><img src="'+z+'" alt=""></p><p>Nest 这么设计是为了避免你自己返回的响应和 Nest 返回的响应的冲突。</p><p>如果你不会自己返回响应，可以通过 passthrough 参数告诉 Nest：</p><p><img src="'+Z+'" alt=""></p><p><img src="'+$+'" alt=""></p><p>除了注入 @Res 不会返回响应外，注入 @Next 也不会：</p><p><img src="'+Y+'" alt=""></p><p>当你有两个 handler 来处理同一个路由的时候，可以在第一个 handler 里注入 next，调用它来把请求转发到第二个 handler：</p><p><img src="'+ss+'" alt=""></p><p>Nest 不会处理注入 @Next 的 handler 的返回值。</p><p>handler 默认返回的是 200 的状态码，你可以通过 @HttpCode 修改它：</p><p><img src="'+is+'" alt=""></p><p><img src="'+as+'" alt=""></p><p>当然，你也可以修改 response header，通过 @Header 装饰器：</p><p><img src="'+ps+'" alt=""></p><p><img src="'+ts+'" alt=""></p><p>此外，你还可以通过 @Redirect 装饰器来指定路由重定向的 url：</p><p><img src="'+ns+'" alt=""></p><p><img src="'+ls+`" alt=""></p><p>或者在返回值的地方设置 url：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;xxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Redirect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">async </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jump</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;https://www.baidu.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      statusCode: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">302</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>你还可以给返回的响应内容指定渲染引擎，不过这需要先这样设置：</p><p><img src="`+es+`" alt=""></p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { NestFactory } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@nestjs/core&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { AppModule } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./app.module&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { NestExpressApplication } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@nestjs/platform-express&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { join } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;path&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bootstrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NestFactory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">NestExpressApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;(AppModule);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">useStaticAssets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;..&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;public&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setBaseViewsDir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(__dirname, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;..&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;views&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setViewEngine</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hbs&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> app.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">listen</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bootstrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre></div><p>分别指定静态资源的路径和模版的路径，并指定模版引擎为 handlerbars。</p><p>当然，还需要安装模版引擎的包 hbs：</p><pre><code>npm install --save hbs
</code></pre><p>然后准备图片和模版文件：</p><p><img src="`+hs+'" alt=""></p><p><img src="'+rs+'" alt=""></p><p>在 handler 里指定模版和数据：</p><p><img src="'+ks+'" alt=""></p><p>就可以看到渲染出的 html 了：</p><p><img src="'+os+'" alt=""></p><p>案例代码在<a href="https://github.com/QuarkGluonPlasma/nestjs-course-code/tree/main/all-decorator" target="_blank" rel="noreferrer">小册仓库</a>。</p><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>这节我们梳理了下 Nest 全部的装饰器</p><ul><li>@Module： 声明 Nest 模块</li><li>@Controller：声明模块里的 controller</li><li>@Injectable：声明模块里可以注入的 provider</li><li>@Inject：通过 token 手动指定注入的 provider，token 可以是 class 或者 string</li><li>@Optional：声明注入的 provider 是可选的，可以为空</li><li>@Global：声明全局模块</li><li>@Catch：声明 exception filter 处理的 exception 类型</li><li>@UseFilters：路由级别使用 exception filter</li><li>@UsePipes：路由级别使用 pipe</li><li>@UseInterceptors：路由级别使用 interceptor</li><li>@SetMetadata：在 class 或者 handler 上添加 metadata</li><li>@Get、@Post、@Put、@Delete、@Patch、@Options、@Head：声明 get、post、put、delete、patch、options、head 的请求方式</li><li>@Param：取出 url 中的参数，比如 /aaa/:id 中的 id</li><li>@Query: 取出 query 部分的参数，比如 /aaa?name=xx 中的 name</li><li>@Body：取出请求 body，通过 dto class 来接收</li><li>@Headers：取出某个或全部请求头</li><li>@Session：取出 session 对象，需要启用 express-session 中间件</li><li>@HostParm： 取出 host 里的参数</li><li>@Req、@Request：注入 request 对象</li><li>@Res、@Response：注入 response 对象，一旦注入了这个 Nest 就不会把返回值作为响应了，除非指定 passthrough 为true</li><li>@Next：注入调用下一个 handler 的 next 方法</li><li>@HttpCode： 修改响应的状态码</li><li>@Header：修改响应头</li><li>@Redirect：指定重定向的 url</li><li>@Render：指定渲染用的模版引擎</li></ul><p>把这些装饰器用熟，就掌握了 nest 大部分功能了。</p>',139),cs=[gs];function ds(ms,_s,ys,Fs,Cs,us){return a(),i("div",null,cs)}const As=s(Es,[["render",ds]]);export{bs as __pageData,As as default};
